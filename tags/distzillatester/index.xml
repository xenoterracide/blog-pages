<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Distzillatester on Caleb Cushing&#39;s blog</title>
    <link>http://blog.xenoterracide.com/tags/distzillatester/index.xml</link>
    <description>Recent content in Distzillatester on Caleb Cushing&#39;s blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <atom:link href="http://blog.xenoterracide.com/tags/distzillatester/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Writing a simple Dist::Zilla::Tester test</title>
      <link>http://blog.xenoterracide.com/post/writing-a-simple-distzillatester-test/</link>
      <pubDate>Wed, 10 Nov 2010 08:59:00 +0000</pubDate>
      
      <guid>http://blog.xenoterracide.com/post/writing-a-simple-distzillatester-test/</guid>
      <description>&lt;p&gt;Hopefully, someone will use the blog post to write an actual doc patch, seeing as how this is undocumented.&lt;br /&gt;&lt;br /&gt;I finally wrote &lt;a href=&#34;https://github.com/xenoterracide/Dist-Zilla-Plugin-OurPkgVersion/blob/4d1bc0270a3abb6dce68ae70b0d31290bb7d97ad/t/01-basic.t&#34;&gt;A test for DZP::OurPkgVersion&lt;/a&gt; with the help of CJM. So I figure it&amp;rsquo;s best to share the knowledge imparted upon me to all those who are writing plugins without tests.&lt;br /&gt;&lt;br /&gt;Before we get started I&amp;rsquo;m going to advise that this test will only check the output that dzil built, if you need it to test anything more sophisticated, you&amp;rsquo;ll have to learn more.&lt;br /&gt;&lt;br /&gt;First you&amp;rsquo;ll want to create a corpus repo like &lt;code&gt;/corpus/MyDZTRepo&lt;/code&gt; with a basic minimal repo. This repo is simply a repo that you are using to test your plugin against, to make sure it works right. You put it in corpus so that if you have tests that you have to check in your corpus, those tests themselves aren&amp;rsquo;t run when the test suite is run. The &lt;code&gt;dist.ini&lt;/code&gt; doesn&amp;rsquo;t need to contain anymore than the basic stuff needed to build. You &lt;code&gt;.pm&lt;/code&gt; files need not have anymore data than what you&amp;rsquo;re going to need to make your dzil plugin do its job. In the case of DZP::OurPkgVersion I only needed to test that the output found the &lt;code&gt;# VERSION&lt;/code&gt; string correctly in a couple of scenario&amp;rsquo;s. So that meant having &lt;code&gt;# VERSION&lt;/code&gt; in the &lt;code&gt;.pm&amp;rsquo;s&lt;/code&gt; and &lt;code&gt;[OurPkgVersion]&lt;/code&gt; in the dist.ini.&lt;br /&gt;&lt;br /&gt;&lt;script src=&#34;https://gist.github.com/670539.js&#34;&gt; &lt;/script&gt;&lt;noscript&gt;&lt;pre&gt;&lt;code&gt;name    = DZT0&lt;br /&gt;author  = Caleb Cushing &lt;a href=&#34;mailto:xenoterracide@gmail.com&#34;&gt;xenoterracide@gmail.com&lt;/a&gt;&lt;br /&gt;license =  Artistic_2_0&lt;br /&gt;version = 0.1.0&lt;br /&gt;copyright_holder = Caleb Cushing&lt;br /&gt;&lt;br /&gt;[@Filter]&lt;br /&gt;-bundle = @Basic&lt;br /&gt;-remove = Readme&lt;br /&gt;&lt;br /&gt;[OurPkgVersion]&lt;/code&gt;&lt;code&gt;&lt;br /&gt;use strict;&lt;br /&gt;use warnings;&lt;br /&gt;package DZT0;&lt;br /&gt;# VERSION&lt;br /&gt;# ABSTRACT: my abstract&lt;br /&gt;1;&lt;/code&gt;&lt;/pre&gt;&lt;/noscript&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;script src=&#34;https://gist.github.com/669238.js&#34;&gt; &lt;/script&gt;&lt;noscript&gt;&lt;pre&gt;&lt;code&gt;#!/usr/bin/perl&lt;br /&gt;use strict;&lt;br /&gt;use warnings;&lt;br /&gt;use Test::More;&lt;br /&gt;use Dist::Zilla::Tester;&lt;br /&gt;&lt;br /&gt;# specify where the dist lives&lt;br /&gt;my $tzil = Dist::Zilla::Tester-&amp;gt;from_config({ dist_root =&amp;gt; &amp;lsquo;corpus/DZT&amp;rsquo; });&lt;br /&gt;&lt;br /&gt;# function to essentially run dzil build&lt;br /&gt;$tzil-&amp;gt;build;&lt;/code&gt;&lt;/pre&gt;&lt;/noscript&gt;&lt;br /&gt;&lt;br /&gt;First DZT (Dist::Zilla::Tester) doesn&amp;rsquo;t provide any tests of its own so you still need to use &lt;code&gt;Test::More&lt;/code&gt; or some other testing framework. Next you need to initialize the tester object by telling it where the root of your corpus repo is.  After that, unless you need to do other work, you can run &lt;code&gt;$tzil-&amp;gt;build&lt;/code&gt; so that the build is run.&lt;br /&gt;&lt;br /&gt;So now lets slurp a file into memory so we can check to see if it was built right. You&amp;rsquo;ll want to look in &lt;code&gt;&amp;lsquo;build/*&amp;rsquo;&lt;/code&gt; as the basic root of the build directory. So &lt;code&gt;&amp;lsquo;build/t/test1.t&amp;rsquo;&lt;/code&gt; if you need to slurp a test.&lt;br /&gt;&lt;br /&gt;&lt;script src=&#34;https://gist.github.com/670857.js&#34;&gt; &lt;/script&gt;&lt;noscript&gt;&lt;pre&gt;&lt;code&gt;#slurp a file&lt;br /&gt;my $lib_0 = $tzil-&amp;gt;slurp_file(&amp;lsquo;build/lib/DZT0.pm&amp;rsquo;);&lt;/code&gt;&lt;/pre&gt;&lt;/noscript&gt;&lt;br /&gt;&lt;br /&gt;Now that we&amp;rsquo;ve pulled our build files into memory lets code up what the result should be. We can just do this with a simple heredoc, obviously you can do it another way.&lt;br /&gt;&lt;br /&gt;&lt;script src=&#34;https://gist.github.com/670860.js&#34;&gt; &lt;/script&gt;&lt;noscript&gt;&lt;pre&gt;&lt;code&gt;my $elib_0 = &amp;lt;&amp;lt;&amp;lsquo;END LIB0&amp;rsquo;;&lt;br /&gt;use strict;&lt;br /&gt;use warnings;&lt;br /&gt;package DZT0;&lt;br /&gt;our $VERSION = 0.1.0;# VERSION&lt;br /&gt;# ABSTRACT: my abstract&lt;br /&gt;1;&lt;br /&gt;END LIB0&lt;/code&gt;&lt;/pre&gt;&lt;/noscript&gt;&lt;br /&gt;&lt;br /&gt;Now that we&amp;rsquo;ve gotten that, all we have to do is compare the file that we expect dzil to output and the file that dzil actually built. This is just standard &lt;code&gt;Test::More&lt;/code&gt;&lt;br /&gt;&lt;br /&gt;&lt;script src=&#34;https://gist.github.com/670867.js&#34;&gt; &lt;/script&gt;&lt;noscript&gt;&lt;pre&gt;&lt;code&gt;is ( $lib_0, $elib_0, &amp;lsquo;check DZT0.pm&amp;rsquo; );&lt;br /&gt;done_testing;&lt;/code&gt;&lt;/pre&gt;&lt;/noscript&gt;&lt;br /&gt;&lt;br /&gt;Now let&amp;rsquo;s take a look at it all together.&lt;br /&gt;&lt;script src=&#34;https://gist.github.com/670873.js&#34;&gt; &lt;/script&gt;&lt;noscript&gt;&lt;pre&gt;&lt;code&gt;#!/usr/bin/perl&lt;br /&gt;use strict;&lt;br /&gt;use warnings;&lt;br /&gt;use Test::More;&lt;br /&gt;use Dist::Zilla::Tester;&lt;br /&gt;&lt;br /&gt;my $tzil = Dist::Zilla::Tester-&amp;gt;from_config({ dist_root =&amp;gt; &amp;lsquo;corpus/DZT&amp;rsquo; });&lt;br /&gt;&lt;br /&gt;$tzil-&amp;gt;build;&lt;br /&gt;&lt;br /&gt;my $lib_0 = $tzil-&amp;gt;slurp_file(&amp;lsquo;build/lib/DZT0.pm&amp;rsquo;);&lt;br /&gt;&lt;br /&gt;# e short for expected files&lt;br /&gt;my $elib_0 = &amp;lt;&amp;lt;&amp;lsquo;END LIB0&amp;rsquo;;&lt;br /&gt;use strict;&lt;br /&gt;use warnings;&lt;br /&gt;package DZT0;&lt;br /&gt;our $VERSION = 0.1.0;# VERSION&lt;br /&gt;# ABSTRACT: my abstract&lt;br /&gt;1;&lt;br /&gt;END LIB0&lt;br /&gt;&lt;br /&gt;is ( $lib_0, $elib_0, &amp;lsquo;check DZT0.pm&amp;rsquo; );&lt;br /&gt;&lt;br /&gt;done_testing;&lt;/code&gt;&lt;/pre&gt;&lt;/noscript&gt;&lt;br /&gt;&lt;br /&gt;Pretty simple huh? Hope this means more dzil modules getting tested now. Including more of mine.&lt;div class=&#34;blogger-post-footer&#34;&gt;&lt;br /&gt;&amp;ndash;&lt;br /&gt;
This &lt;span xmlns:dc=&#34;http://purl.org/dc/elements/1.1/&#34; href=&#34;http://purl.org/dc/dcmitype/Text&#34; rel=&#34;dc:type&#34;&gt;work&lt;/span&gt; by &lt;a xmlns:cc=&#34;http://creativecommons.org/ns#&#34; href=&#34;http://www.xenoterracide.com&#34; property=&#34;cc:attributionName&#34; rel=&#34;cc:attributionURL&#34;&gt;Caleb Cushing&lt;/a&gt; is licensed under a &lt;a rel=&#34;license&#34; href=&#34;http://creativecommons.org/licenses/by-nc-sa/3.0/&#34;&gt;Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License&lt;/a&gt;.&lt;/div&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>