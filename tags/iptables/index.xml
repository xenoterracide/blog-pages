<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Iptables on Caleb Cushing&#39;s blog</title>
    <link>http://blog.xenoterracide.com/tags/iptables/index.xml</link>
    <description>Recent content in Iptables on Caleb Cushing&#39;s blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <atom:link href="http://blog.xenoterracide.com/tags/iptables/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Port forwarding in OpenWRT</title>
      <link>http://blog.xenoterracide.com/post/port-forwarding-in-openwrt/</link>
      <pubDate>Sat, 03 Oct 2009 19:34:00 +0000</pubDate>
      
      <guid>http://blog.xenoterracide.com/post/port-forwarding-in-openwrt/</guid>
      <description>&lt;p&gt;So you need the outside world to have access to some box&amp;rsquo;s on your internal network. first you should use &lt;a href=&#34;http://xenoterracide.blogspot.com/2009/07/openwrt-static-dhcp.html&#34;&gt;Static DHCP&lt;/a&gt; to tell static the IP&amp;rsquo;s of the computer you&amp;rsquo;re routing to. Then you of course need to know the inbound from the outside world and the port on the computer you are forwarding too. For this example we&amp;rsquo;ll forward WAN (Wide Area Network (or (probably) the Internet)) port 8080  to a local dev box running Apache on httpd (we assume you know how to set apache up and make sure it&amp;rsquo;s working on the LAN(Local Area Network)).&lt;br /&gt;&lt;br /&gt;edit &lt;code&gt;/etc/config/firewall&lt;/code&gt;. note: /etc/firewall.user is for manual iptables commands and is basically a shell script. I only recommend this if /etc/config/firewall doesn&amp;rsquo;t do what you want (like multiport).&lt;br /&gt;&lt;code&gt;&lt;pre&gt;config redirect&lt;br /&gt;        option src              wan&lt;br /&gt;        option src_dport        8080&lt;br /&gt;        option dest             lan&lt;br /&gt;        option dest_ip          192.168.1.3&lt;br /&gt;        option dest_port        80&lt;br /&gt;        option proto            tcp&lt;br /&gt;&lt;/pre&gt;&lt;/code&gt;&lt;br /&gt;&lt;br /&gt;So options src and dest merely define the too and from interfaces (to be honest I&amp;rsquo;m not sure they actually do anything. as I&amp;rsquo;m not seeing any changes to what&amp;rsquo;s in iptables). src_dport is what external port you want to listen on. dest_port is what you want it to go to. dest_ip is what ip you want it to go to and proto is the protocol it listens on (yes you have to specify separately for udp if what you&amp;rsquo;re forwarding uses both tcp and udp).&lt;br /&gt;&lt;br /&gt;After you&amp;rsquo;ve edited and saved the file to fit your case run &lt;code&gt;/etc/init.d/firewall restart&lt;/code&gt; and it should work&lt;br /&gt;&lt;br /&gt;IMPORTANT: there&amp;rsquo;s a bug in 7.x and pre 8.09.2 with 2.4-bcrm kernels and netfilter code&amp;hellip; it &amp;lsquo;causes port drift. if the bug is affecting you. (it did me) reboot the system. you will be able to see it with a -j LOG iptables rule. the output was thus for me &lt;code&gt;&lt;br /&gt;IN=eth0.1 OUT=br-lan SRC=66.98.131.131 DST=192.168.1.3 LEN=44 TOS=0x00 PREC=0x20 TTL=47 ID=63450 DF PROTO=TCP SPT=54402 DPT=82 WINDOW=5840 RES=0x00 SYN URGP=0&lt;/code&gt; as you can see the destination port(DPT) is 82 instead of 80 like it&amp;rsquo;s supposed to be. 8.09.2 should be out in a few weeks it&amp;rsquo;s currently at rc2.&lt;div class=&#34;blogger-post-footer&#34;&gt;&lt;br /&gt;&amp;ndash;&lt;br /&gt;
This &lt;span xmlns:dc=&#34;http://purl.org/dc/elements/1.1/&#34; href=&#34;http://purl.org/dc/dcmitype/Text&#34; rel=&#34;dc:type&#34;&gt;work&lt;/span&gt; by &lt;a xmlns:cc=&#34;http://creativecommons.org/ns#&#34; href=&#34;http://www.xenoterracide.com&#34; property=&#34;cc:attributionName&#34; rel=&#34;cc:attributionURL&#34;&gt;Caleb Cushing&lt;/a&gt; is licensed under a &lt;a rel=&#34;license&#34; href=&#34;http://creativecommons.org/licenses/by-nc-sa/3.0/&#34;&gt;Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License&lt;/a&gt;.&lt;/div&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>iptables browsing samba shares</title>
      <link>http://blog.xenoterracide.com/post/iptables-browsing-samba-shares/</link>
      <pubDate>Sat, 16 May 2009 00:37:00 +0000</pubDate>
      
      <guid>http://blog.xenoterracide.com/post/iptables-browsing-samba-shares/</guid>
      <description>&lt;p&gt;NOTE: this assumes that you&amp;rsquo;ve read my previous post on &lt;a href=&#34;http://xenoterracide.blogspot.com/2008/04/iptables-for-average-desktop-user.html&#34;&gt;basic iptables setup on the desktop&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;So I just spent the longest time trying to determine what ports I needed to browse and use samba shares. The sad answer is it&amp;rsquo;s just one.&lt;br /&gt;&lt;br /&gt;&lt;code&gt;&lt;br /&gt;iptables -A INPUT -p udp &amp;ndash;sport 137 -j ACCEPT&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;br /&gt;the catch with all the information I found with google was that most of it was for samba servers. I didn&amp;rsquo;t want that. I just want to be able to browse my roommates network shares, and download from them. None of the information google provided suggested I need to allow the source port on the other end.&lt;div class=&#34;blogger-post-footer&#34;&gt;&lt;br /&gt;&amp;ndash;&lt;br /&gt;
This &lt;span xmlns:dc=&#34;http://purl.org/dc/elements/1.1/&#34; href=&#34;http://purl.org/dc/dcmitype/Text&#34; rel=&#34;dc:type&#34;&gt;work&lt;/span&gt; by &lt;a xmlns:cc=&#34;http://creativecommons.org/ns#&#34; href=&#34;http://www.xenoterracide.com&#34; property=&#34;cc:attributionName&#34; rel=&#34;cc:attributionURL&#34;&gt;Caleb Cushing&lt;/a&gt; is licensed under a &lt;a rel=&#34;license&#34; href=&#34;http://creativecommons.org/licenses/by-nc-sa/3.0/&#34;&gt;Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License&lt;/a&gt;.&lt;/div&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>iptables for the average desktop user</title>
      <link>http://blog.xenoterracide.com/post/iptables-for-the-average-desktop-user/</link>
      <pubDate>Tue, 08 Apr 2008 23:20:00 +0000</pubDate>
      
      <guid>http://blog.xenoterracide.com/post/iptables-for-the-average-desktop-user/</guid>
      <description>&lt;p&gt;The Best guide for learning the basics of iptables is here&lt;br /&gt;&lt;a href=&#34;http://www.gentoo.org/doc/en/articles/linux-24-stateful-fw-design.xml&#34;&gt;Linux 2.4 Stateful firewall design&lt;/a&gt; for the most part it continues to apply to the 2.6 kernel. The only things that won&amp;rsquo;t apply to your linux system will be: emerge if you aren&amp;rsquo;t on gentoo, and the kernel options which have changed since 2.4 and even a couple of times during 2.6.&lt;br /&gt;&lt;br /&gt;I&amp;rsquo;m not going to cover those here. If you need help building your kernel or installing iptables I suggest that you consult with either the iptables home page or even better your distribution. Chances are it is already installed, and may even be configured.&lt;br /&gt;&lt;br /&gt;First Let&amp;rsquo;s see if we have any rules.&lt;br /&gt;&lt;br /&gt;&lt;em&gt;The following commands require root access, and can be run in a root shell, with sudo, or in a shell script by root&lt;/em&gt;&lt;br /&gt;&lt;br /&gt;&lt;code&gt;iptables -L -v&lt;/code&gt;&lt;br /&gt;&lt;br /&gt;your output should look something like this if you have no rules&lt;br /&gt;&lt;code&gt;&lt;br /&gt;Chain INPUT (policy ACCEPT 211 packets, 27413 bytes)&lt;br /&gt; pkts bytes target     prot opt in     out     source               destination &lt;br /&gt;&lt;br /&gt;Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)&lt;br /&gt; pkts bytes target     prot opt in     out     source               destination &lt;br /&gt;&lt;br /&gt;Chain OUTPUT (policy ACCEPT 312 packets, 211K bytes)&lt;br /&gt; pkts bytes target     prot opt in     out     source               destination&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;br /&gt;If it looks different no worries it just means that your distro has already installed rules.&lt;br /&gt;&lt;br /&gt;If so make sure BEFORE CONTINUING to flush them. FIRST check to make sure your policies are set to accept (you can see that in caps above) if they are anything else run &lt;br /&gt;&lt;br /&gt;&lt;code&gt;&lt;br /&gt;iptables -P INPUT ACCEPT&lt;br /&gt;iptables -P FORWARD ACCEPT&lt;br /&gt;iptables -P OUTPUT ACCEPT&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;br /&gt;now that your policies are clean you should flush the rules&lt;br /&gt;&lt;code&gt;&lt;br /&gt;iptables -F #flush all rules&lt;br /&gt;iptables -X #delete all chains&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;br /&gt;all right now hopefully you are at a clean state. If you have ever used iptables for nat you may not be, but that is beyond the scope of this article.&lt;br /&gt;&lt;br /&gt;Now we need to create rules, since this is for normal deskop users you shouldn&amp;rsquo;t have any services listening, also you shoudn&amp;rsquo;t be routing anything.&lt;br /&gt;&lt;br /&gt;to disable routing with iptables (I&amp;rsquo;m ignoring the kernel setting for this)&lt;br /&gt;&lt;br /&gt;&lt;code&gt;&lt;br /&gt;iptables -P FORWARD DROP &lt;br /&gt;&lt;/code&gt;&lt;br /&gt;# set all forwarded packets to go bye bye if they reach the end of the chain&lt;br /&gt;&lt;br /&gt;the output chain is good on accept for the normal user, only a masochist would want to write rules for it. You generally should trust your outbound traffic.&lt;br /&gt;&lt;br /&gt;Now to secure input&lt;br /&gt;&lt;code&gt;&lt;br /&gt;iptables -A INPUT -m state &amp;ndash;state INVALID -j DROP &lt;br /&gt;iptables -A INPUT -m state &amp;ndash;state RELATED,ESTABLISHED -j ACCEPT&lt;br /&gt;iptables -A INPUT -i lo -j ACCEPT&lt;br /&gt;iptables -P INPUT DROP &lt;br /&gt;&lt;/code&gt;&lt;br /&gt;#this rule drops all packets with a bad state&lt;br /&gt;#accept any packets that have something to do with ones we&amp;rsquo;ve sent on outbound&lt;br /&gt;#accept any packets coming or going on localhost (this can be very important&lt;br /&gt;# set all packets not matching these rules to drop&lt;br /&gt;&lt;br /&gt;Various linux distro&amp;rsquo;s may require you to do something special to save these rules so that they survive a reboot. consult your distributions community.&lt;br /&gt;&lt;br /&gt;If you have rules that you want to keep but also want to use mine I suggest putting mine first, you should do the -A rules in reverse but use a -I for insert.&lt;br /&gt;&lt;br /&gt;When dealing with iptables always take care when applying &lt;code&gt;iptables -P DROP&lt;/code&gt;. You can be locked out of the machine or the internet if you apply this without the appropriate rules in place.&lt;br /&gt;&lt;br /&gt;That&amp;rsquo;s it. your desktop should be secure from an attacker that you aren&amp;rsquo;t allowing in. There are of course other things that you can do to make it even more secure but those are beyond the scope of this tutorial.&lt;div class=&#34;blogger-post-footer&#34;&gt;&lt;br /&gt;&amp;ndash;&lt;br /&gt;
This &lt;span xmlns:dc=&#34;http://purl.org/dc/elements/1.1/&#34; href=&#34;http://purl.org/dc/dcmitype/Text&#34; rel=&#34;dc:type&#34;&gt;work&lt;/span&gt; by &lt;a xmlns:cc=&#34;http://creativecommons.org/ns#&#34; href=&#34;http://www.xenoterracide.com&#34; property=&#34;cc:attributionName&#34; rel=&#34;cc:attributionURL&#34;&gt;Caleb Cushing&lt;/a&gt; is licensed under a &lt;a rel=&#34;license&#34; href=&#34;http://creativecommons.org/licenses/by-nc-sa/3.0/&#34;&gt;Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License&lt;/a&gt;.&lt;/div&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>